name: C++ CI

on:
  push:
  pull_request:

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      # Install cpplint
      - name: Install cpplint
        run: pip install cpplint

      # Run cpplint on all source files (src/ ì „ì²´ ê²€ì‚¬)
      - name: Run cpplint
        run: |
          cpplint --recursive src/ || true   # ê²½ê³ ëŠ” ë¬´ì‹œ (ì‹¤íŒ¨ ì•„ë‹˜)

      # Build Morse project
      - name: Build Morse project
        run: |
          if [ -f src/morse.cpp ]; then
            echo "ğŸ”¨ Compiling morse.cpp ..."
            g++ -std=c++17 src/morse.cpp -o src/morse.out
          else
            echo "âŒ src/morse.cpp not found!"
            exit 1
          fi

      # Run Morse tests (optional for all branches)
      - name: Run Morse tests
        run: |
          if [ -f tests/test_mos.sh ]; then
            echo "ğŸš€ Running test_mos.sh ..."
            chmod +x tests/test_mos.sh
            ./tests/test_mos.sh || true   # ì‹¤íŒ¨í•´ë„ ì „ì²´ job ì‹¤íŒ¨ ì•„ë‹˜
          else
            echo "âš ï¸ tests/test_mos.sh not found!"
          fi

  # Extra job only for main branch (strict: í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œ ë¨¸ì§€ ë¶ˆê°€)
  main-branch-tests:
    if: github.base_ref == 'main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Build Morse project (main branch strict)
        run: |
          g++ -std=c++17 src/morse.cpp -o src/morse.out

      - name: Run Morse tests (strict, must pass)
        run: |
          cd tests
          chmod +x test_mos.sh
          ./test_mos.sh


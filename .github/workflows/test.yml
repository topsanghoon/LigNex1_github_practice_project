name: C++ CI

on:
  push:
  pull_request:

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      # Install cpplint
      - name: Install cpplint
        run: pip install cpplint

      # Run cpplint on all source files (src/ 전체 검사)
      - name: Run cpplint
        run: |
          cpplint --recursive src/ || true

      # Build Morse project
      - name: Build Morse project
        run: |
          if [ -f src/morse.cpp ]; then
            echo "🔨 Compiling morse.cpp ..."
            g++ -std=c++17 src/morse.cpp -o src/morse.out
          fi

      # Run Morse tests (루트에서 실행)
      - name: Run Morse tests
        run: |
          if [ -f tests/test_mos.sh ]; then
            echo "🚀 Running test_mos.sh ..."
            chmod +x tests/test_mos.sh
            ./tests/test_mos.sh || true
          fi

  # Extra job only for main branch (strict: 테스트 실패 시 머지 불가)
  main-branch-tests:
    if: github.base_ref == 'main'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build Morse project (main branch strict)
        run: |
          echo "🔨 Compiling morse.cpp (main branch strict) ..."
          g++ -std=c++17 src/morse.cpp -o src/morse.out
      - name: Run Morse tests (strict)
        run: |
          chmod +x tests/test_mos.sh
          ./tests/test_mos.sh

